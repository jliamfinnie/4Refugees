<section ng-controller="OfferingsPublicController" ng-init="initialize()">
<div class="row">
<!-- s11 looks a bit nicer on a smaller screen so it won't display all the way to the edge -->
  <div class="col m12 s11">
    <br>
    <h4 ng-class="properties.rightToLeft ? 'right':'left'" ng-if="offerType=='request'">{{properties.searchNeedInCurrentLanguage}}</h4>
    <h4 ng-class="properties.rightToLeft ? 'right':'left'" ng-if="offerType=='offer'">{{properties.findHelpInCurrentLanguage}}</h4>
    <form name="offeringFormSearch" ng-submit="searchAll()" novalidate>
        <!-- start of category section -->
        <div id="category" class="col s12 ibm-offering-category-checkbox" ng-class="properties.rightToLeft ? 'arabic':'latin'">
        <br><br>
                <input type="checkbox" id="training" name="training" ng-model="category.training">
                <label for="training">{{properties.jobTraining}}</label>   
                
                <input type="checkbox" id="childcare" name="childcare" ng-model="category.childcare">
                <label for="childcare">{{properties.childCare}}</label> 

                <input type="checkbox" id="courses" name="courses" ng-model="category.courses">
                <label for="courses">{{properties.languageCourses}}</label> 

                <input type="checkbox" id="medical" name="medical" ng-model="category.medical">
                <label for="medical">{{properties.medicalAssistance}}</label> 

                
                <input type="checkbox" id="others" name="others" ng-model="category.others">
                <label for="others">{{properties.others}}</label>    
        <br><br>       
        </div> <!-- end of category section -->
        
        <!-- start with the middle section without category for a different grid layout -->    
        <div class="row">
          <div class="col m6 s11" ng-class="properties.rightToLeft ? 'right':'left'">
            <div class="input-field ibm-input-field" ng-class="properties.rightToLeft ? 'arabic':'latin'">
                <div class="row">
                    <!-- Location, toggle between geo-location and manual city-list by clicking on icon -->
                    <div ng-class="properties.rightToLeft ? 'col l1 m2 s2 push-s10 right':'col l1 m2 s2 left'">
                      <a ng-click="toggleGeoLocation()">
                        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                        width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
                        <path d="M24.484,4.515C22.313,2.343,19.313,1,16,1c-3.314,0-6.314,1.343-8.484,3.515C5.344,6.687,4,9.686,4,13
                            c0,3.508,1.344,6.685,3.516,8.984L16,31l8.484-9.016C26.656,19.685,28,16.508,28,13C28,9.686,26.656,6.687,24.484,4.515z
                            M23.028,20.613L16,28.081L8.969,20.61C7.055,18.583,6,15.881,6,13c0-2.671,1.04-5.182,2.93-7.071C10.818,4.04,13.329,3,16,3
                            c2.671,0,5.182,1.04,7.07,2.93C24.959,7.818,26,10.329,26,13C26,15.881,24.945,18.583,23.028,20.613z"/>
                        <circle cx="16" cy="13" r="4"/>
                        </svg>
                      </a>
                    </div>
                    <div ng-class="properties.rightToLeft ? 'col l11 m10 s10 pull-s2':'col l11 m10 s10'">
                        <!-- when geo.auto.active is true, this field will be filled in when we get our geo location response -->
                        <a ng-if="geo.auto.active" ng-click="toggleGeoLocation()">
                          <input class="ibm-force-text-black" type="text" placeholder="{{properties.city}}" ng-model="geo.auto.location.city" readonly>
                        </a>
                        <!-- when geo.manual.active is true, this value is retrieved form an existing offering -->
                        <a ng-if="geo.manual.active" ng-click="toggleGeoLocation()">
                          <input class="ibm-force-text-black" type="text" placeholder="{{properties.city}}" ng-model="geo.manual.location.city" readonly>
                        </a>
                        <!-- use ng-show instead of ng-if because ng-if removes the child node from DOM, ng-model has to bind to a parent element ID
                          but we want to bind to the child ID ng-model="geo.list.location" so we use ng-show instead, it's not expensive in this case
                          since we only load the city list when geo location is blocked or not available -->
                        <select ng-show="geo.list.active" name="repeatSelect" ng-model="geo.list.location" 
                            ng-options="option.city for option in geo.list.data">
                        </select>
                    </div>
                </div>
                <!-- Toggle advanced options on/off -->
                <br>
                <div class="row" ng-class="properties.rightToLeft ? 'arabic':'latin'">
                    <div class="ibm-toggle-advanced-options" ng-class="properties.rightToLeft ? 'col l1 m2 s2 push-s10 right':'col l1 m2 s2 left'" ng-click="toggleAdvanced()">
                      <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                        width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
                            <path d="M27.5,16c0-0.615-0.062-1.213-0.155-1.802L31,11l-3.105-5.098l-4.359,1.424c-1.042-0.906-2.248-1.623-3.569-2.109L19,1h-6
                                l-0.966,4.217c-1.321,0.486-2.527,1.203-3.57,2.11L4.105,5.902L1,11l3.655,3.199C4.562,14.787,4.5,15.386,4.5,16
                                c0,0.615,0.062,1.213,0.155,1.802L1,21l3.106,5.098l4.358-1.424c1.042,0.907,2.249,1.624,3.57,2.11L13,31h6l0.966-4.217
                                c1.321-0.486,2.527-1.203,3.569-2.109l4.359,1.424L31,21l-3.655-3.197C27.438,17.214,27.5,16.615,27.5,16z M28.416,21.397
                                l-1.406,2.308l-2.854-0.932l-1.078-0.352l-0.855,0.744c-0.868,0.755-1.86,1.341-2.947,1.742l-1.017,0.375l-0.242,1.056L17.406,29
                                h-2.812l-0.61-2.664l-0.242-1.056l-1.017-0.375c-1.088-0.4-2.08-0.986-2.948-1.742L8.921,22.42l-1.078,0.353L4.99,23.705
                                l-1.406-2.308l2.388-2.09l0.83-0.727L6.63,17.49C6.543,16.934,6.5,16.446,6.5,16c0-0.446,0.043-0.934,0.13-1.49l0.172-1.09
                                l-0.83-0.727l-2.388-2.091l1.406-2.308l2.854,0.933L8.921,9.58l0.855-0.744c0.869-0.756,1.86-1.342,2.948-1.742l1.017-0.375
                                l0.242-1.056L14.594,3h2.812l0.61,2.664l0.242,1.056l1.017,0.375c1.087,0.4,2.079,0.986,2.947,1.742l0.855,0.744l1.078-0.352
                                l2.854-0.933l1.406,2.308l-2.388,2.089l-0.831,0.727l0.173,1.091C25.457,15.066,25.5,15.553,25.5,16s-0.043,0.935-0.131,1.49
                                l-0.173,1.091l0.831,0.727L28.416,21.397z"/>
                            <path d="M16,10c-3.314,0-6,2.685-6,6s2.686,6,6,6c3.315,0,6-2.685,6-6S19.315,10,16,10z M16,18c-1.104,0-2-0.896-2-2s0.896-2,2-2
                                s2,0.896,2,2S17.104,18,16,18z"/>
                    </svg>
                    </div>
                    <div ng-class="properties.rightToLeft ? 'col l11 m10 s10 pull-s2 right-align':'col l11 m10 s10 left-align'" ng-click="toggleAdvanced()">
                        <a ng-if="!showDetails">{{properties.showAdvanced}}</a>
                        <a ng-if="showDetails">{{properties.hideAdvanced}}</a>
                    </div>
                </div>
            </div> <!-- end of input-field ibm-input-field -->
            <!-- All advanced options are below -->
            <div data-my-slide="showDetails">
              <div class="ibm-input-field" ng-class="properties.rightToLeft ? 'arabic':'latin'">
                <div class="row">
                  <div ng-class="properties.rightToLeft ? 'col l1 m2 s2 push-s10 right':'col l1 m2 s2 left'">
                      <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                          width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
                          <path d="M16,6C10.478,6,6,10.479,6,16c0,5.523,4.478,10,10,10c5.523,0,10-4.477,10-10C26,10.479,21.523,6,16,6z M18,18l-8,4l4-8
                          l8-4L18,18z"/>
                          <path d="M16,2C8.268,2,2,8.268,2,16s6.268,14,14,14s14-6.268,14-14S23.732,2,16,2z M16,28C9.383,28,4,22.617,4,16S9.383,4,16,4
                          s12,5.383,12,12S22.617,28,16,28z"/>
                          <circle cx="16" cy="16" r="1"/>
                      </svg>
                  </div>
                  <div ng-class="properties.rightToLeft ? 'col l11 m10 s10 pull-s2':'col l11 m10 s10'">
                      <input name="radius" type="text" ng-model="radius" id="radius" placeholder="{{properties.searchRadius}}">
                  </div>
                </div>
              </div>
              <div class="ibm-input-field" ng-class="properties.rightToLeft ? 'arabic':'latin'">
                <div class="row">
                  <div ng-class="properties.rightToLeft ? 'col l1 m2 s2 push-s10 right':'col l1 m2 s2 left'">
                      <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                      width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
                      <path d="M16,2C8.268,2,2,8.268,2,16s6.268,14,14,14c7.732,0,14-6.268,14-14S23.732,2,16,2z M16,28C9.383,28,4,22.617,4,16
                      S9.383,4,16,4c6.617,0,12,5.383,12,12S22.617,28,16,28z"/>
                      <polygon points="22.646,8.646 16.353,14.939 12.707,11.293 11.293,12.707 14.939,16.354 13.646,17.646 14.353,18.354 15.646,17.06 
                      17.293,18.707 18.707,17.293 17.06,15.646 23.353,9.354   "/>
                      </svg>
                  </div>
                  <div ng-class="properties.rightToLeft ? 'col l11 m10 s10 pull-s2':'col l11 m10 s10'">
                      <input id="searchWhen" type="date" ng-model="when" name="searchWhen" class="datepicker" placeholder="{{properties.when}}">
                  </div>         
                </div> 
              </div>
            </div> <!-- end of showDetails -->
            <!-- Submit area for buttons, error displays, etc -->
            <div class="ibm-submit-area" ng-class="properties.rightToLeft ? 'arabic-rotate-icon':'latin'">
              <div class="row">
                <div class="col m12 s12">
                    <button type="submit" class="btn waves-effect waves-light">
                    {{properties.search}}
                    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                        width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
                        <path d="M12,1C5.926,1,1,5.926,1,12c0,6.074,4.926,11,11,11s11-4.926,11-11C23,5.926,18.074,1,12,1z M12,21c-4.962,0-9-4.038-9-9
                        s4.038-9,9-9s9,4.038,9,9S16.962,21,12,21z"/>
                        <rect x="23.879" y="21.05" transform="matrix(0.7071 -0.7071 0.7071 0.7071 -10.7696 26)" width="4.243" height="9.899"/>
                        <circle cx="21" cy="21" r="1"/>
                    </svg>
                    </button>
                </div>
                <br><br>
                <div class="col m12 s12">
                    <!-- Swap offerType - if they searched for an offering, they need to create a help request -->
                    <a ui-sref="offerings.create({offerType:'offer', offeringId:'0'})" ng-if="offerType=='request'">{{properties.offerOthersHelpText}}</a>
                    <a ui-sref="offerings.create({offerType:'request', offeringId:'0'})" ng-if="offerType=='offer'">{{properties.tellOthersNeedsText}}</a>
                </div>
                <!-- TODO should be a pop-up and it can be closed -->
                <div class="col m12 s12" ng-show="error">
                    <strong ng-bind="error"></strong>
                </div>
              </div> <!-- end of row -->
            </div> <!-- end of ibm-submit-area -->
            <!-- Display current search progress -->
            <div class="offering-search-status" ng-class="properties.rightToLeft ? 'arabic':'latin'">
              <div class="row">
                <div class="col m12 s12" ng-show="searchStatus">
                  <strong ng-bind="searchStatus"></strong>
                </div>
              </div>
            </div>
          </div> <!-- end of grid col m6 s11 -->
        </div> <!-- end of row - middle section without category -->
    </form>       
    <!-- show search results -->
    <div class="row">
      <div ng-class="properties.rightToLeft ? 'right-align col m12 s11 right':'left-algin col m12 offset-s1 s11'">
        <ul>
          <li ng-repeat="offering in offerings" class="list-group-item">
            <div class="row">
              <div class="ibm-offering-list card">
                <!-- display profile  -->
                <div id="volunteerProfile-{{ $index }}" class="modal">
                  <div class="modal-content">
                  <div class="row">
                  <div class="col s12">
                  <a href="#!" class="modal-action modal-close waves-effect" ng-class="properties.rightToLeft ? 'left':'right'">
                    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                        width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
                        <polygon points="20.293,10.293 16,14.586 11.707,10.293 10.293,11.707 14.586,16 10.293,20.293 11.707,21.707 16,17.414 
                            20.293,21.707 21.707,20.293 17.414,16 21.707,11.707     "/>
                        <path d="M16,2C8.269,2,2,8.269,2,16s6.269,14,14,14s14-6.269,14-14S23.731,2,16,2z M16,28C9.383,28,4,22.617,4,16S9.383,4,16,4
                            s12,5.383,12,12S22.617,28,16,28z"/>
                    </svg>
                  </a>
                  </div>
                  <div class="col s12">
                  <h4 ng-bind="offering.user.displayName"></h4>
                  <!-- TODO waiting for Kai's change -->
                  </div>
                  </div>
                  </div>
                </div>
                <div class="card-content">
                  <div class="row">
                    <div ng-class="properties.rightToLeft ? 'col m1 s2 push-s10 right':'col m1 s2 left'">
                        <svg ng-if="offering.offerType=='request'" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                            width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
                      <path d="M16,2C8.269,2,2,8.269,2,16s6.269,14,14,14s14-6.269,14-14S23.731,2,16,2z M23,16c0,0.893-0.174,1.743-0.479,2.528
                          c-0.711,1.829-2.164,3.281-3.992,3.992C17.744,22.826,16.893,23,16,23c-0.893,0-1.744-0.174-2.529-0.479
                          c-1.828-0.711-3.281-2.164-3.992-3.992C9.174,17.743,9,16.893,9,16c0-0.893,0.174-1.743,0.479-2.527
                          c0.711-1.829,2.165-3.283,3.992-3.994C14.257,9.174,15.107,9,16,9c0.893,0,1.743,0.174,2.529,0.479
                          c1.827,0.71,3.281,2.165,3.992,3.994C22.826,14.257,23,15.107,23,16z M19.286,8.714C18.282,8.259,17.172,8,16,8
                          s-2.282,0.259-3.286,0.714L9.766,5.766C11.586,4.653,13.715,4,16,4s4.414,0.653,6.234,1.766L19.286,8.714z M8.714,19.286
                          l-2.948,2.948C4.653,20.415,4,18.285,4,16s0.653-4.415,1.766-6.234l2.948,2.948C8.26,13.718,8,14.828,8,16S8.26,18.282,8.714,19.286
                          z M12.714,23.286C13.718,23.741,14.828,24,16,24s2.282-0.259,3.286-0.714l2.948,2.948C20.414,27.347,18.285,28,16,28
                          s-4.414-0.653-6.234-1.766L12.714,23.286z M23.286,12.714l2.948-2.948C27.347,11.585,28,13.715,28,16s-0.653,4.415-1.766,6.234
                          l-2.948-2.948C23.74,18.282,24,17.172,24,16S23.74,13.718,23.286,12.714z"/>
                      </svg>
                      <svg ng-if="offering.offerType=='offer'" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                          width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
                          <polygon points="19,5 17,6 21,12 17,12 4,12 4,15 17,15 17,16 1,16 1,19 17,19 17,20 4,20 4,23 17,23 17,24 7,24 7,27 17,27 23,27 
                            31,25 31,12     "/>
                      </svg>
                    </div>
                    <div ng-class="properties.rightToLeft ? 'col m11 s10 pull-s2':'col m11 s10'">
                        <a ng-href="{{offering.descriptionLink}}" target="_blank"><span ng-if="offering.description.indexOf('http') > -1 || offering.description.indexOf('http') > -1" class="card-title" >{{offering.descriptionTitle}}</span></a>
                        <span ng-if="offering.description.indexOf('http') == -1 && offering.description.indexOf('https') == -1 " class="card-title">{{offering.description}}</span>
                    </div>
                  </div> 
                      <p><div class="chip waves-effect waves-light" ng-bind="offering.category"></div></p>
                      <p>{{properties.location}}: <span ng-bind="offering.city"></span></p>
                      <p>{{properties.distance}}: <span ng-bind="offering.distance"></span> {{properties.kilometres}}</p>
                      <p>
                        {{properties.offeredBy}}
                        <span>
                        <a ng-if="authentication.user._id != offering.user._id"  class="waves-effect waves-light modal-trigger" ng-click="profileModalDetails($index)" href="#volunteerProfile-@(index)" ng-bind="offering.user.displayName"></a>
                        <a ng-if="authentication.user._id == offering.user._id" class="waves-effect waves-light modal-trigger" ng-click="profileModalDetails($index)" href="#volunteerProfile-@(index)">{{properties.me}}</a>
                        </span>
                      </p>
                      <small>
                        {{properties.availableOn}}
                        <span ng-bind="offering.when | date:'mediumDate'"></span>
                        <br>{{properties.expiresOn}}
                        <span ng-bind="offering.expiry | date:'mediumDate'"></span>
                      </small>
                  
                </div> 
                <div class="card-action">
                    <!-- ibm-submit-area to interact with results, provides appropriate buttons depending on authentication -->
                    <div class="ibm-submit-area" ng-class="properties.rightToLeft ? 'arabic':'latin'">
                      <div class="row">
                        <div class="col m12 s12" ng-if="authentication.user._id == offering.user._id">
                            <button class="offering-submit-button btn waves-effect waves-light" ng-class="properties.rightToLeft ? 'arabic2-rotate-icon':'latin'" ui-sref="offerings.edit({offerType: offering.offerType, offeringId: offering._id})">
                              {{properties.editButton}}
                              <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                              width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
                              <rect x="24.379" y="1.257" transform="matrix(0.7071 -0.7071 0.7071 0.7071 3.8726 20.3492)" width="4.243" height="8.485"/>
                              <path d="M5,21l6,6l15-15l-6-6L5,21z M11,24.171L7.828,21L20,8.829L23.172,12L11,24.171z"/>
                              <polygon points="1,31 6,29 3,26   "/>
                              </svg>
                            </button>
                        </div>
                        <div class="col m12 s12" ng-if="authentication.user._id != offering.user._id">
                            <button class="offering-submit-button btn waves-effect waves-light" ui-sref="matches.createFromOffer({offeringId: offering._id, offeringDescription: offering.description, recipientName: offering.user.displayName, recipientId: offering.user._id})">
                              {{properties.contact}}
                              <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                              width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
                              <path d="M16,4L1,12v1v15h30V13v-1L16,4z M7,11h18v4.2L16,20l-9-4.8V11z M29,26H3V14.066L16,21l13-6.934V26z"/>
                              </svg>
                            </button>
                        </div>
                      </div> <!-- end of row -->
                    </div> <!-- end of ibm-submit-area -->
                </div> <!-- end of card-action -->
              </div> <!-- end of card -->
            </div>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>
</section>
